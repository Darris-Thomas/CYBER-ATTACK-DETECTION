from keras.models import load_model

# returns a compiled model
# identical to the previous one
model = load_model('modelcls.hdf5')
import numpy as np
from sklearn.feature_selection import SelectKBest
from sklearn.feature_selection import chi2
import pickle
from sklearn.preprocessing import MinMaxScaler
scaler=pickle.load(open('scalerlstm1','rb'))
featsel=pickle.load(open('ch_featlstm1','rb'))

def test(val):
    val_list=val.split(',')
    flist=[abs(float(x)) for x in val_list]
    selfeat=featsel.transform([flist])
    print(selfeat.shape)
    scdata=scaler.transform(selfeat)
    
    ypred=model.predict(scdata)[0]
    res=(ypred[0][0])*100
    print(res)  
   
    print("-----------------------------------")

    if(res<1):
        return "Attack detected"
    else:
        return "No Attack detected"
    






# tdata1='''70.39932429,127673.0908,-49.57230843,127648.0176,-169.5783186,127723.2374,65.68961121,605.91099,-57.00357104,626.78553,-173.5890232,602.4319,70.4222426,127673.0908,0.0,0.0,0.0,0.0,65.00779144,611.5874,118.5678861,13.18392,-100.8692198,13.91636,59.999,0.01,6.391383458,0.076290455,0,60.65826798,124631.8125,-59.29595943,124484.3594,-179.3380777,124715.0703,-119.5504813,612.7967529,117.7267525,632.5321045,0.859680212,610.1417236,60.6802407,124611.9844,0.0,0.0,0.0,0.0,-120.3414991,618.3013916,-64.05304275,12.7658844,69.39789118,12.8288269,59.99900055,0.02,6.130100104,3.135101005,0,60.66477135,124187.9063,-59.31259095,124162.833,-179.3014124,124212.9796,-119.7539088,610.12252,117.6855311,628.25041,0.658901464,606.82654,60.68768966,124187.9063,0.0,0.0,0.0,0.0,-120.4872947,614.88338,-64.81298579,12.08526,70.38786513,11.90215,59.999,0.02,6.111439531,3.140520023,0,70.45089049,127723.2374,-49.53793097,127096.4056,-169.532482,127773.3839,65.64377459,604.44611,-56.87179074,621.84156,-173.8697725,599.86836,70.46234965,127522.6512,0.0,0.0,0.0,0.0,64.95049566,608.47453,119.3012721,12.26837,-102.060972,11.71904,59.999,0.01,6.341831592,0.077897157,0.0,0,0,0,0,0,0,0,0,0,0,0,0'''

# tdata2='''73.73393866,130305.7842,-46.2548828,130280.7109,-166.2322451,130381.004,71.80880046,483.59351,-50.91302968,500.98896,-167.441186,481.02997,73.75112739,130330.8575,0.0,0.0,0.0,0.0,71.13271027,488.35437,125.0079317,10.62038,-94.52084746,11.35282,60.005,0.0,8.190006048,0.027903536,0,66.11298,128283.9453,-53.85223378,128144.4688,-173.8833657,128382.9609,-114.919736,488.8858643,122.2146649,505.531311,5.462951784,487.6270142,66.12945441,128269.5938,0.0,0.0,0.0,0.0,-115.7656959,493.8526001,-58.65325912,10.3969574,72.17742983,10.76889038,60.00500107,0.0,7.931677134,-3.136359551,0,66.11932956,127823.5305,-53.86376232,127798.4572,-173.8525838,127873.677,-115.107221,487.43882,122.1832498,502.08762,5.265482137,484.32595,66.14224787,127823.5305,0.0,0.0,0.0,0.0,-115.9036324,491.10102,-60.60747557,10.25416,74.02041755,9.70483,60.007,0.0,7.881699104,-3.129600582,0,73.78550486,130355.9307,-46.19758702,129729.099,-166.1921381,130381.004,71.86609624,481.39619,-50.78124938,496.41121,-167.5901551,478.10021,73.79696401,130155.3446,0.0,0.0,0.0,0.0,71.14416942,485.2415,125.2772219,10.25416,-95.97043068,10.07105,60.005,0.0,8.162755259,0.026663485,0.0,0,0,0,0,0,0,0,0,0,0,0,0'''

# tdata3='''74.08344291,130581.5902,-45.89964897,130556.5169,-165.8827408,130656.81,72.15257514,482.86107,-50.43747471,499.15786,-167.2864874,481.39619,74.10636122,130581.5902,0.0,0.0,0.0,0.0,71.45929621,487.62193,127.597701,9.70483,-96.65798004,10.43727,60.003,0.0,8.171531808,0.025616995,0,66.50848893,128585.4063,-53.4457419,128442.6094,-173.4878568,128673.4141,-114.8153707,489.8643494,122.6486278,504.2266846,5.693664902,487.3695374,66.53046165,128566.9453,0.0,0.0,0.0,0.0,-115.5075147,493.6809692,-61.74041583,9.653091431,75.45135806,9.738922119,60.00500107,0.0,7.889894743,-3.126736895,0,66.50321128,128124.4097,-53.47415102,128099.3364,-173.4629725,128149.483,-114.9983591,487.80504,122.6186977,500.80585,5.471746943,484.50906,66.52612959,128124.4097,0.0,0.0,0.0,0.0,-115.6515309,490.91791,-62.38937431,9.1555,76.49559523,8.97239,60.003,0.0,7.857910788,-3.121717478,0,74.14646827,130631.7367,-45.84808277,129979.8317,-165.8369042,130681.8832,72.18122303,481.21308,-50.31142399,494.76322,-167.3953494,478.28332,74.15219785,130431.1505,0.0,0.0,0.0,0.0,71.48221452,484.69217,126.4747037,9.33861,-97.25385615,9.1555,60.003,0.0,8.135292283,0.026595462,0.0,0,0,0,0,0,0,0,0,0,0,0,0'''


# tdata4='''-158.6634726,132712.8181,81.36000691,132085.9864,-38.63454413,132762.9647,-158.6233656,288.21514,80.0880406,291.87734,-38.64600328,288.03203,-158.6520135,132512.232,0.0,0.0,0.0,0.0,-159.0702727,289.3138,0.0,0.0,0.0,0.0,59.997,0.0,13.38075465,-0.008466936,0,-163.1038955,131208.4219,76.93677273,131183.3486,-43.0577783,131233.4952,8.915223292,294.62399,-111.9846011,297.73686,129.1504166,293.89155,-163.0809772,131208.4219,0.0,0.0,0.0,0.0,8.691769752,295.35643,0.0,0.0,0.0,0.0,59.999,0.0,12.91645033,-3.003866783,0,-163.1325434,131183.3486,76.90812484,131133.2021,-43.10361493,131233.4952,11.64823198,280.52452,-109.7901727,284.18672,131.533921,281.80629,-163.1096251,131183.3486,0.0,0.0,0.0,0.0,11.12684038,282.17251,0.0,0.0,0.0,0.0,59.999,0.01,13.60676701,-3.065111919,0,-158.8595587,132614.7188,81.20269836,132466.875,-38.85040287,132700.0625,-155.8657911,279.3216553,83.25165266,282.7377319,-35.66436892,279.4189453,-158.8375928,132590.625,0.0,0.0,0.0,0.0,-156.0965013,280.4775391,0.0,0.0,0.0,0.0,59.99900055,0.0,13.78393354,-0.055310541,0.0,0,0,0,0,0,0,0,0,0,0,0,0'''

# tdata5='''-159.0645431,132361.7923,80.95320687,131734.9606,-39.029885,132437.0121,-158.5660698,287.29959,80.50057022,290.04624,-38.47411594,286.93337,-159.0530839,132161.2062,0.0,0.0,0.0,0.0,-158.8525487,288.03203,0.0,0.0,0.0,0.0,59.999,0.0,13.32971161,-0.012899397,0,-163.4935068,130982.7625,76.54143185,130957.6892,-43.43593045,131007.8358,9.132947254,292.42667,-111.6694743,294.99021,129.3051152,291.69423,-163.4705885,130982.7625,0.0,0.0,0.0,0.0,8.92095287,292.976,0.0,0.0,0.0,0.0,60.0,0.0,12.94759207,-3.014538425,0,-163.5221547,130957.6892,76.51278396,130932.6159,-43.48176707,131032.909,10.15854171,284.91916,-110.9418179,287.84892,130.2562251,285.83471,-163.4992364,130982.7625,0.0,0.0,0.0,0.0,9.820496609,286.20093,0.0,0.0,0.0,0.0,60.0,0.0,13.34159651,-3.041313194,0,-159.2056307,132561.0469,80.85113487,132414.4688,-39.17999365,132655.7969,-157.3544309,282.5717773,81.9168083,284.9349976,-37.26837396,282.9551697,-159.1781597,132541.4063,0.0,0.0,0.0,0.0,-157.574158,283.4758911,0.0,0.0,0.0,0.0,60.0,0.0,13.53706386,-0.037110122,0.0,0,0,0,0,0,0,0,0,0,0,0,0'''

# tdata6='''-159.1161093,132336.7191,80.90737025,131684.814,-39.09291036,132386.8656,-158.6004473,287.29959,80.53494768,289.68002,-38.47411594,286.56715,-159.1046501,132136.1329,0.0,0.0,0.0,0.0,-158.8525487,287.84892,0.0,0.0,0.0,0.0,59.999,0.0,13.30934124,-0.011824625,0,-163.5508026,130982.7625,76.49559523,130957.6892,-43.49322623,131007.8358,9.069921897,292.60978,-111.6121785,294.44088,129.2077124,291.69423,-163.5164252,130982.7625,0.0,0.0,0.0,0.0,8.89230498,292.79289,0.0,0.0,0.0,0.0,60.0,0.0,12.89104561,-3.014013572,0,-163.5679914,130957.6892,76.46121776,130932.6159,-43.53906285,131032.909,9.992383947,285.83471,-111.0965165,288.03203,130.0614195,286.56715,-163.5565322,130982.7625,0.0,0.0,0.0,0.0,9.654338848,286.75026,0.0,0.0,0.0,0.0,60.0,0.0,13.26455732,-3.040127558,0,-159.2495761,132573.7656,80.8181792,132410.7031,-39.23492544,132653.4531,-157.5082467,283.3041992,81.76849757,285.5358276,-37.39471539,283.2527161,-159.2276102,132545.9531,0.0,0.0,0.0,0.0,-157.716991,284.0194702,0.0,0.0,0.0,0.0,60.0,0.0,13.49996345,-0.033915261,0.0,0,0,0,0,0,0,0,0,0,0,0,0'''



# test(tdata1)
# test(tdata2)
# test(tdata3)
# print("####################")
# test(tdata4)
# test(tdata5)
# test(tdata6)